<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таймер до Открытия ЗБТ</title>
    <style>
        :root {
            --primary-color: #ffcc00;
            --secondary-color: #4a90e2;
            --dark-bg: rgba(0, 0, 0, 0.7);
            --light-text: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('1afdec38202b2cfc822f29663eb18b99.jpg') no-repeat center center fixed;
            background-size: cover;
            color: var(--light-text);
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Анимированный фон поверх основного */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 204, 0, 0.3);
            animation: float 15s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.5;
            }
            50% {
                transform: translateY(-20px) translateX(20px) rotate(180deg);
                opacity: 1;
            }
        }

        /* Анимация загрузки с японскими символами */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.9)), 
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><text x="50%" y="50%" font-family="Arial" font-size="10" fill="%23ffcc00" text-anchor="middle" dominant-baseline="middle">侍</text></svg>');
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            transition: opacity 1s ease-out;
        }

        .samurai-symbol {
            font-size: 8rem;
            color: var(--primary-color);
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            animation: symbolPulse 2s infinite alternate;
            font-family: 'MS Mincho', 'SimSong', serif;
        }

        @keyframes symbolPulse {
            0% {
                transform: scale(1);
                text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            }
            100% {
                transform: scale(1.1);
                text-shadow: 0 0 20px rgba(255, 204, 0, 0.8), 0 0 30px rgba(255, 204, 0, 0.6);
            }
        }

        .loading-text {
            font-size: 1.5rem;
            color: var(--light-text);
            text-align: center;
            max-width: 80%;
            margin-bottom: 2rem;
        }

        .loading-bar-container {
            width: 300px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary-color);
        }

        .japanese-text {
            position: absolute;
            font-size: 1.2rem;
            color: rgba(255, 204, 0, 0.7);
            opacity: 0;
            animation: textAppear 8s infinite;
            font-family: 'MS Mincho', 'SimSong', serif;
        }

        @keyframes textAppear {
            0%, 100% {
                opacity: 0;
                transform: translateY(20px);
            }
            10%, 90% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .text-1 {
            top: 20%;
            left: 10%;
            animation-delay: 0.5s;
        }

        .text-2 {
            top: 30%;
            right: 10%;
            animation-delay: 2s;
        }

        .text-3 {
            bottom: 30%;
            left: 15%;
            animation-delay: 4s;
        }

        .text-4 {
            bottom: 20%;
            right: 15%;
            animation-delay: 6s;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .content {
            text-align: center;
            padding: 40px 30px;
            background-color: var(--dark-bg);
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            animation: fadeIn 1.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent, 
                rgba(255, 204, 0, 0.1), 
                transparent
            );
            transform: rotate(45deg);
            animation: shine 6s infinite;
            pointer-events: none;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 25px;
            color: var(--primary-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                text-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
            }
            50% {
                transform: scale(1.05);
                text-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
            }
            100% {
                transform: scale(1);
                text-shadow: 0 0 5px rgba(255, 204, 0, 0.5);
            }
        }

        .timer-container {
            margin: 25px 0;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            border: 1px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .timer-container::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #ffcc00, #4a90e2, #ffcc00);
            background-size: 400% 400%;
            z-index: -1;
            animation: gradientShift 3s ease infinite;
            border-radius: 15px;
            filter: blur(15px);
            opacity: 0.3;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            letter-spacing: 1px;
            color: var(--primary-color);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            transition: transform 0.3s ease;
        }

        .time-unit:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
        }

        .time-value {
            font-size: 2.8rem;
            line-height: 1;
            position: relative;
        }

        .time-value.changing {
            animation: flip 0.5s ease;
        }

        @keyframes flip {
            0% {
                transform: rotateX(0);
            }
            50% {
                transform: rotateX(90deg);
            }
            100% {
                transform: rotateX(0);
            }
        }

        .time-label {
            font-size: 0.9rem;
            margin-top: 5px;
            color: var(--light-text);
            text-transform: uppercase;
        }

        .timezone-info {
            margin-top: 15px;
            font-size: 1rem;
            color: #cccccc;
        }

        /* Анимированный разделитель */
        .divider {
            height: 2px;
            width: 80%;
            background: linear-gradient(to right, transparent, var(--primary-color), transparent);
            margin: 30px auto;
            position: relative;
            overflow: hidden;
        }

        .divider::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.8), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        .links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }

        a.button {
            display: inline-block;
            padding: 12px 25px;
            background-color: var(--secondary-color);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        a.button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        a.button:hover::before {
            left: 100%;
        }

        a.button:hover {
            background-color: transparent;
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .notification-form {
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            animation: slideUp 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .notification-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-color);
            transform: scaleY(0);
            transform-origin: top;
            animation: growLine 2s forwards;
            animation-delay: 0.5s;
        }

        @keyframes growLine {
            to {
                transform: scaleY(1);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-form h2 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }

        button {
            padding: 12px 25px;
            background-color: var(--primary-color);
            color: black;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        button:hover::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(30, 30);
                opacity: 0;
            }
        }

        button:hover {
            background-color: #e6b800;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            color: #cccccc;
            animation: fadeIn 2s ease-out;
        }

        /* Конфетти эффект */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
        }

        /* Новые стили для модального окна правил */
        .rules-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-out;
        }

        .rules-content {
            position: relative;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            margin: 5% auto;
            padding: 40px;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(255, 204, 0, 0.3);
            border: 1px solid var(--primary-color);
            animation: slideIn 0.5s ease-out;
            color: var(--light-text);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-rules {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-rules:hover {
            color: #ffdd33;
            transform: rotate(90deg);
        }

        .rules-title {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 2.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .rules-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 204, 0, 0.2);
        }

        .rules-section:last-child {
            border-bottom: none;
        }

        .rules-section-title {
            color: var(--primary-color);
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .rules-section-title::before {
            content: "•";
            margin-right: 10px;
            font-size: 2rem;
            color: var(--secondary-color);
        }

        .rules-list {
            list-style-type: none;
            padding-left: 20px;
        }

        .rules-list li {
            margin-bottom: 10px;
            position: relative;
            padding-left: 25px;
            line-height: 1.5;
        }

        .rules-list li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .rules-highlight {
            color: var(--primary-color);
            font-weight: bold;
        }

        .rules-notice {
            margin-top: 30px;
            padding: 15px;
            background-color: rgba(255, 204, 0, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            text-align: center;
            font-style: italic;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .timer {
                font-size: 1.8rem;
                gap: 10px;
            }
            
            .time-unit {
                min-width: 70px;
                padding: 8px;
            }
            
            .time-value {
                font-size: 2rem;
            }
            
            .time-label {
                font-size: 0.7rem;
            }
            
            .links {
                flex-direction: column;
                align-items: center;
            }
            
            a.button {
                width: 100%;
                max-width: 300px;
                margin-bottom: 10px;
            }
            
            .rules-content {
                padding: 30px 20px;
                margin: 10% auto;
                width: 95%;
            }
            
            .rules-title {
                font-size: 1.8rem;
            }
            
            .rules-section-title {
                font-size: 1.2rem;
            }
            
            .samurai-symbol {
                font-size: 5rem;
            }
            
            .loading-text {
                font-size: 1.2rem;
            }
            
            .japanese-text {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .content {
                padding: 20px 15px;
            }
            
            .timer {
                flex-direction: column;
                gap: 8px;
            }
            
            .time-unit {
                width: 100%;
                flex-direction: row;
                justify-content: space-between;
                min-width: auto;
            }
            
            .time-value {
                font-size: 1.8rem;
            }
            
            .samurai-symbol {
                font-size: 4rem;
            }
            
            .loading-text {
                font-size: 1rem;
            }
            
            .japanese-text {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

<!-- Экран загрузки с японскими символами -->
<div class="loading-screen" id="loadingScreen">
    <div class="samurai-symbol">侍</div>
    <div class="loading-text">Готовимся к великому путешествию в мир самураев...</div>
    <div class="loading-bar-container">
        <div class="loading-bar" id="loadingBar"></div>
    </div>
    <div class="japanese-text text-1">武士道 - Путь воина</div>
    <div class="japanese-text text-2">忍 - Терпение</div>
    <div class="japanese-text text-3">勇気 - Мужество</div>
    <div class="japanese-text text-4">名誉 - Честь</div>
</div>

<!-- Анимированный фон -->
<div class="animated-bg" id="animated-bg"></div>

<div class="container" id="mainContainer">
    <div class="content">
        <h1>Ожидайте Открытие ЗБТ!</h1>
        
        <div class="timer-container">
            <div class="timer" id="countdown">
                <div class="time-unit">
                    <span class="time-value" id="days">00</span>
                    <span class="time-label">дней</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="hours">00</span>
                    <span class="time-label">часов</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="minutes">00</span>
                    <span class="time-label">минут</span>
                </div>
                <div class="time-unit">
                    <span class="time-value" id="seconds">00</span>
                    <span class="time-label">секунд</span>
                </div>
            </div>
            <div class="timezone-info" id="timezone-info">
                Используется часовой пояс Польши (Europe/Warsaw) по умолчанию
            </div>
        </div>

        <!-- Анимированный разделитель -->
        <div class="divider"></div>

        <div class="links">
            <a href="https://forms.gle/uJUFDKFLhv5coGHRA" target="_blank" class="button">Подать заявку</a>
            <a href="https://t.me/quddix/4581" target="_blank" class="button">Подробная информация</a>
            <!-- Новая кнопка Правила -->
            <a href="#" class="button" onclick="openRules(); return false;">Правила</a>
        </div>
    </div>

    <!-- Модальное окно с правилами -->
    <div id="rulesModal" class="rules-modal">
        <div class="rules-content">
            <span class="close-rules" onclick="closeRules()">&times;</span>
            <h2 class="rules-title">Правила Проекта</h2>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Общие правила</h3>
                <ul class="rules-list">
                    <li>Уважай других игроков.</li>
                    <li>Запрещены оскорбления, токсичность, провокации и спам.</li>
                    <li>Запрещена реклама сторонних серверов, ссылок и каналов.</li>
                    <li>Не выдавай себя за администрацию.</li>
                    <li>Администрация имеет право выносить решения по ситуации, даже если это не прописано в правилах.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Геймплей и поведение</h3>
                <ul class="rules-list">
                    <li>Гриферство строго запрещено (ломание чужих построек, кража ресурсов, убийства без согласия и т.д.).</li>
                    <li>Не занимай чужую территорию без разрешения владельца.</li>
                    <li>Не спавни злоумышленно мобов или лаг-машины (например, чрезмерные фермы с энтити).</li>
                    <li>Используй редстоун с умом — не создавай схемы, вызывающие лаги.</li>
                    <li>PvP только по обоюдному согласию. Без дуэлей — без атак.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Строительство</h3>
                <ul class="rules-list">
                    <li>Запрещено строить некрасивые "грязные" столбы, кубы из грязи, лавовые кресты и т.п.</li>
                    <li>Общественные места (спавн, дороги, хабы) нельзя портить или перестраивать без согласования.</li>
                    <li>Уважай стиль и усилия других игроков — не тролль их постройки.</li>
                    <li>Прежде чем строиться рядом с кем-то — спроси разрешения.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Технические ограничения</h3>
                <ul class="rules-list">
                    <li>Авто-кликеры, макросы и сторонние скрипты запрещены.</li>
                    <li>Запрещены читы, x-ray, баги на дюп и любые другие несправедливые преимущества.</li>
                    <li>Использование багов игры запрещено. Нашёл баг — сообщи админам.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Ивенты и торговля</h3>
                <ul class="rules-list">
                    <li>Мошенничество на ивентах и в торговле запрещено.</li>
                    <li>Уважай правила и формат ивентов, не мешай другим участвовать.</li>
                    <li>Торговые зоны — только в отведённых местах или по согласованию с админом.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Администрация</h3>
                <ul class="rules-list">
                    <li>Решение администрации — окончательное.</li>
                    <li>За нарушение правил возможен варн, кик, бан или вайп.</li>
                    <li>Если не уверен — спроси. Лучше уточнить, чем попасть в бан.</li>
                </ul>
            </div>
            
            <div class="rules-section">
                <h3 class="rules-section-title">Чат и общение</h3>
                <ul class="rules-list">
                    <li>За запрещены темы: политика, насилие, религиозные споры, NSFW, пропаганда наркотиков и другие запрещённые законом материалы.</li>
                    <li>Не флуди — не отправляй одинаковые или бессмысленные сообщения подряд.</li>
                    <li>Запрещён чрезмерный КАПС (ПИСЬМО ВОТ ТАКИМИ БУКВАМИ).</li>
                    <li>Чат — не место для драк. Решайте конфликты спокойно или через администрацию.</li>
                    <li>Не используй мат, завуалированный мат или оскорбительные прозвища.</li>
                    <li>Мемы и шутки — хорошо, но не за счёт других игроков.</li>
                    <li>Реклама, ссылки и внешние IP — только с разрешения администрации.</li>
                    <li>Использование символов, иероглифов или форматирования для нарушения читаемости — запрещено.</li>
                </ul>
            </div>
            
            <!-- Добавленное уведомление -->
            <div class="rules-notice">
                <p>Правила могут изменяться со временем. Каждый игрок, играя на сервере, соглашается с правилами сервера.</p>
            </div>
        </div>
    </div>

    <div class="notification-form">
        <h2>Уведомления о начале ЗБТ</h2>
        <div class="form-group">
            <label for="email">Email для уведомлений:</label>
            <input type="email" id="email" placeholder="Ваш email">
        </div>
        <div class="form-group">
            <label for="timezone">Ваш часовой пояс:</label>
            <select id="timezone">
                <option value="">Выберите часовой пояс</option>
                <!-- Опции будут добавлены через JavaScript -->
            </select>
        </div>
        <div class="form-group">
            <label for="notify">Получать уведомления:</label>
            <select id="notify">
                <option value="all">Все уведомления</option>
                <option value="24">За 24 часа</option>
                <option value="12">За 12 часов</option>
                <option value="1">За 1 час</option>
                <option value="10">За 10 минут</option>
            </select>
        </div>
        <button onclick="saveNotificationPreferences()">Сохранить настройки</button>
    </div>
</div>

<div class="footer">
    <p>Таймер обновляется в реальном времени с учетом вашего часового пояса</p>
</div>

<script>
// Глобальные переменные
let userTimezone = 'Europe/Warsaw'; // По умолчанию используем часовой пояс Польши
let targetDate = new Date('2025-09-16T00:00:00Z'); // UTC время
let lastSeconds = 0;

// Функция для отображения экрана загрузки
function showLoadingScreen() {
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingBar = document.getElementById('loadingBar');
    const mainContainer = document.getElementById('mainContainer');
    
    // Показываем экран загрузки
    loadingScreen.style.display = 'flex';
    mainContainer.style.opacity = '0';
    
    // Анимируем прогресс бар
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            
            // Завершаем загрузку
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    mainContainer.style.opacity = '1';
                }, 1000);
            }, 500);
        }
        loadingBar.style.width = progress + '%';
    }, 200);
}

// Функция для заполнения выпадающего списка часовых поясов
function populateTimezones() {
    const timezoneSelect = document.getElementById('timezone');
    const timezones = Intl.supportedValuesOf('timeZone');
    
    timezones.forEach(tz => {
        const option = document.createElement('option');
        option.value = tz;
        option.textContent = tz;
        if (tz === userTimezone) {
            option.selected = true;
        }
        timezoneSelect.appendChild(option);
    });
}

// Функция для расчета оставшегося времени с учетом часового пояса
function countdownTimer() {
    const now = new Date();
    const localTargetDate = new Date(targetDate.toLocaleString('en-US', { timeZone: userTimezone }));
    
    // Разница во времени
    const remainingTime = localTargetDate - now;

    if (remainingTime <= 0) {
        document.getElementById('days').textContent = '00';
        document.getElementById('hours').textContent = '00';
        document.getElementById('minutes').textContent = '00';
        document.getElementById('seconds').textContent = '00';
        document.getElementById('timezone-info').textContent = 'Открытие ЗБТ началось!';
        
        // Запускаем конфетти при завершении отсчета
        if (lastSeconds > 0) {
            createConfetti();
        }
        
        lastSeconds = 0;
        return;
    }

    const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
    const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);

    // Анимация изменения секунд
    if (seconds !== lastSeconds) {
        const secondsElement = document.getElementById('seconds');
        secondsElement.classList.remove('changing');
        void secondsElement.offsetWidth; // Trigger reflow
        secondsElement.classList.add('changing');
        lastSeconds = seconds;
    }

    // Обновляем отображение таймера
    document.getElementById('days').textContent = days.toString().padStart(2, '0');
    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
    
    // Обновляем информацию о часовом поясе
    const options = { timeZone: userTimezone, timeZoneName: 'long' };
    const timezoneName = new Intl.DateTimeFormat('ru-RU', options).formatToParts(now)
        .find(part => part.type === 'timeZoneName').value;
    
    document.getElementById('timezone-info').textContent = `Ваш часовой пояс: ${timezoneName}. ЗБТ начнется: ${localTargetDate.toLocaleString('ru-RU')}`;
}

// Функция для сохранения предпочтений уведомлений
function saveNotificationPreferences() {
    const email = document.getElementById('email').value;
    const timezone = document.getElementById('timezone').value;
    const notifyOption = document.getElementById('notify').value;
    
    if (timezone) {
        userTimezone = timezone;
        countdownTimer(); // Пересчитываем сразу после изменения
    }
    
    // Здесь будет код для сохранения предпочтений (например, в localStorage или отправка на сервер)
    const preferences = {
        email: email,
        timezone: timezone,
        notifyOption: notifyOption
    };
    
    localStorage.setItem('zbtNotificationPrefs', JSON.stringify(preferences));
    
    // Анимация успешного сохранения
    createConfetti();
    alert('Настройки уведомлений сохранены!');
}

// Функция для загрузки сохраненных предпочтений
function loadNotificationPreferences() {
    const savedPrefs = localStorage.getItem('zbtNotificationPrefs');
    if (savedPrefs) {
        const prefs = JSON.parse(savedPrefs);
        document.getElementById('email').value = prefs.email || '';
        document.getElementById('timezone').value = prefs.timezone || userTimezone;
        document.getElementById('notify').value = prefs.notifyOption || 'all';
        
        if (prefs.timezone) {
            userTimezone = prefs.timezone;
        }
    } else {
        // Если нет сохраненных настроек, устанавливаем часовой пояс Польши по умолчанию
        document.getElementById('timezone').value = userTimezone;
    }
}

// Функция для создания анимированных частиц фона
function createParticles() {
    const container = document.getElementById('animated-bg');
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Случайные размеры и позиции
        const size = Math.random() * 20 + 5;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 15;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.animationDelay = `${delay}s`;
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        
        container.appendChild(particle);
    }
}

// Функция для создания конфетти
function createConfetti() {
    const confettiCount = 100;
    const colors = ['#ffcc00', '#4a90e2', '#ff0000', '#00ff00', '#ffffff'];
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        
        // Случайные свойства
        const color = colors[Math.floor(Math.random() * colors.length)];
        const size = Math.random() * 10 + 5;
        const posX = Math.random() * window.innerWidth;
        const angle = Math.random() * 360;
        
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.backgroundColor = color;
        confetti.style.left = `${posX}px`;
        confetti.style.top = '0';
        confetti.style.transform = `rotate(${angle}deg)`;
        
        document.body.appendChild(confetti);
        
        // Анимация падения
        const animation = confetti.animate([
            { top: '0', opacity: 1, transform: `rotate(0deg)` },
            { top: `${window.innerHeight}px`, opacity: 0, transform: `rotate(${angle + 720}deg)` }
        ], {
            duration: Math.random() * 3000 + 2000,
            easing: 'cubic-bezier(0.1, 0.8, 0.3, 1)'
        });
        
        // Удаляем элемент после завершения анимации
        animation.onfinish = () => {
            confetti.remove();
        };
    }
}

// Функции для открытия/закрытия модального окна с правилами
function openRules() {
    const modal = document.getElementById('rulesModal');
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden'; // Запрещаем прокрутку страницы
    createConfetti(); // Добавляем немного конфетти для эффекта
}

function closeRules() {
    const modal = document.getElementById('rulesModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto'; // Возвращаем прокрутку страницы
}

// Закрытие модального окна при клике вне его области
window.onclick = function(event) {
    const modal = document.getElementById('rulesModal');
    if (event.target == modal) {
        closeRules();
    }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Показываем экран загрузки
    showLoadingScreen();
    
    // Инициализируем остальные компоненты после загрузки
    setTimeout(() => {
        populateTimezones();
        loadNotificationPreferences();
        createParticles(); // Создаем частицы фона
        countdownTimer(); // Вызываем сразу, чтобы показать таймер
        
        // Обновляем таймер каждую секунду
        setInterval(countdownTimer, 1000);
    }, 3500); // Задержка для завершения анимации загрузки
});

// Функция для отправки уведомлений (заглушка для демонстрации)
function scheduleNotifications() {
    // В реальном приложении здесь будет код для планирования уведомлений
    // через Email, Discord или внутриигровые сообщения
    console.log('Уведомления запланированы согласно предпочтениям пользователя');
}
</script>

</body>
</html>